<div
  ng-if="vm.galleryImages.length > 0 && vm.loadedSizes"
  ng-photoswipe slides="vm.galleryImages"
  show="vm.open"
  slide-selector=".product-view-gallery-img-inner > img"
  on-close="vm.closeGallery()"
  options="vm.opts">
</div>

<!--
<div class="breadcrumb">
  <div class="container container-xxlg">
    <p>
      <a href="#">Inicio</a>
      <a href="#"> > Muebles</a>
      <a href="#" class="breadcrumb-active"> > Salas</a>
    </p>
  </div>
</div>
-->
<div class="content-block listing-view">
  <div class="container container-xxlg" layout="row" layout-align="space-between start">

    <!--START NAV-->
    <sidebar-categories
      selected-category-id="vm.lowestCategory.id"
      categories-tree="main.categoriesTree"
      flex="20">
    </sidebar-categories>
    <!--END NAV-->

    <!--MAIN VIEW-->
    <div class="product-view" flex="75">
      <h2 class="listing-view-title">{{vm.product.Name || vm.product.ItemName}}</h2>
      <div ng-if="vm.isLoading" layout-fill layout="row" layout-sm="column" layout-align="center center" class="loading-circle">
        <md-progress-circular md-mode="indeterminate" class="md-accent" md-diameter="150"></md-progress-circular>
      </div>
      <!--PRODUCT VIEW CONTENT-->
      <section ng-if="!vm.isLoading" class="product-view-content">

        <div layout="row">
          <div class="product-view-gallery-wrap" flex="50">

            <div
              ng-if="vm.product.maxDiscount && vm.product.maxDiscount > 0"
              class="product-view-gallery-discount"
              layout="row"
              layout-align="center center">
              <strong>- {{vm.product.maxDiscount}}%</strong>
            </div>

            <div
              ng-if="vm.product.mainPromo && vm.product.mainPromo.hasLM"
              class="slow-movement-sticker"
            >
              <img src="images/boton-lm.png" alt="">
            </div>

            <div class="product-view-gallery">
              <slick
                id="slick-gallery"
                init-onload="true"
                data="vm.areImagesLoaded"
                arrows="true"
                draggable="false"
              >
                <div
                  ng-repeat="image in vm.galleryImages track by $index"
                  class="product-view-gallery-img"
                >
                  <div class="product-view-gallery-img-inner">
                    <img
                      ng-src="{{image.src}}"
                      ng-click="vm.showGallery($index)"
                      alt="{{vm.product.icon_description}}"
                      >
                  </div>
                </div>
              </slick>
            </div>

            <div class="product-view-gallery-thumbs">
              <slick
                id="slick-thumbs"
                infinite="false"
                slides-to-show="4"
                slides-to-scroll="1"
                init-onload="true"
                data="vm.areImagesLoaded"
                arrows="false"
                draggable="false"
              >
                <div ng-repeat="image in vm.galleryImages track by $index">
                  <div class="product-view-gallery-thumb">
                    <a
                      ng-click="vm.setGalleryIndex($index)"
                      href=""
                      data-thumb="{{$index}}"
                      data-selected-index="{{vm.selectedSlideIndex}}"
                      ng-class="
                      {
                        'product-view-gallery-thumb-inner-active' : $index === vm.selectedSlideIndex,
                        'product-view-gallery-thumb-inner-inactive' : $index !== vm.selectedSlideIndex
                      }"
                      class="product-view-gallery-thumb-inner">
                      <img ng-src="{{image.src}}" alt="">
                    </a>
                  </div>
                </div>
              </slick>
            </div>

          </div>

          <!--PRODUCT VIEW DATA-->
          <div flex="50" class="product-view-data">
            <div class="product-view-data-block">
              <h4 ng-click="vm.nextSlide()"><strong>CARACTERISTICAS</strong></h4>
              <table>
                <tr>
                  <td>Código:</td>
                  <td><strong>{{vm.product.ItemCode}}</strong></td>
                </tr>
                <tr ng-repeat="filter in vm.filters">
                  <td 
                    ng-if="filter.Values.length > 0 && filter.Handle != 'color' && filter.Handle != 'ubicacion-uso'">
                    {{filter.Name}}: 
                  </td>
                  <td 
                    ng-if="filter.Values.length > 0 && filter.Handle != 'color' && filter.Handle != 'ubicacion-uso'"
                  >
                    <span ng-repeat="value in filter.Values track by $index">
                      <strong>{{value.Name}}</strong>
                      <span ng-if="$index < (filter.Values.length-1)">,</span>
                    </span>
                  </td>
                </tr>
                <tr>
                  <td>Color</td>
                  <td><strong>{{vm.product.DetailedColor || vm.product.U_COLOR}}</strong></td>
                </tr>
              </table>

            </div>
            <div class="product-view-data-block"
              ng-if="
                vm.product.Length ||
                vm.product.Width  ||
                vm.product.Height ||
                vm.product.Volume ||
                vm.product.Weight ||
                vm.product.Depth  ||
                vm.product.SeatHeight ||
                vm.product.ChairBackHeight||
                vm.product.ArmRestHeight
              "
            >
              <h4><strong>DIMENSIONES</strong></h4>
              <table>
                <tr ng-if="vm.product.Length && vm.product.Length > 0">
                  <td>Largo:</td>
                  <td><strong>{{vm.product.Length | number:2}} {{vm.product.LengthUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.Width && vm.product.Width > 0">
                  <td>Ancho:</td>
                  <td><strong>{{vm.product.Width | number:2}} {{vm.product.WidthUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.Height && vm.product.Height > 0">
                  <td>Alto:</td>
                  <td><strong>{{vm.product.Height | number:2}} {{vm.product.HeightUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.Volume && vm.product.Volume > 0">
                  <td>Volumen:</td>
                  <td><strong>{{vm.product.Volume | number:2}} {{vm.product.VolumeUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.Weight && vm.product.Weight > 0">
                  <td>Peso:</td>
                  <td><strong>{{vm.product.Weight | number:2}} {{vm.product.WeightUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.Depth && vm.product.Depth > 0">
                  <td>Profundidad: </td>
                  <td><strong>{{vm.product.Depth | number:2}} {{vm.product.DepthUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.SeatHeight && vm.product.SeatHeight > 0">
                  <td>Altura asiento: </td>
                  <td><strong>{{vm.product.SeatHeight | number:2}} {{vm.product.SeatHeightUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.ChairBackHeight && vm.product.ChairBackHeight > 0">
                  <td>Altura respaldo: </td>
                  <td><strong>{{vm.product.ChairBackHeight | number:2}} {{vm.product.ChairBackHeightUnitMsr}}</strong></td>
                </tr>
                <tr ng-if="vm.product.ArmRestHeight && vm.product.ArmRestHeight > 0">
                  <td>Altura reposa brazos: </td>
                  <td><strong>{{vm.product.ArmRestHeight | number:2}} {{vm.product.ArmRestHeightUnitMsr}}</strong></td>
                </tr>


              </table>
            </div>

            <div ng-if="vm.hasVariants" class="product-view-data-block">
              <h4 class="product-view-data-block-toggle" ng-class="{'opened-toggle': vm.toggleVariants}">
                <a href="#"  ng-click="vm.toggleVariants = !vm.toggleVariants">
                  <strong>VARIANTES</strong>
                </a>
              </h4>
              <div 
                ng-show="vm.toggleVariants" 
                class="hl-data variants-picker"
              >
              
                  <div ng-repeat="variant in vm.variants">
                    <div 
                      class="variant-row" 
                      ng-if="variant.products.length > 0" 
                      layout="row"
                    >
                      <div flex="30"><strong>{{variant.name}}:</strong></div>

                      <div 
                        ng-if=" variant.handle == 'color' " 
                        flex="70"
                      >

                        <div
                          class="variant-color"
                          layout="row"
                          layout-wrap
                          ng-repeat="prod in variant.products"
                          ng-click="vm.init(prod.id, true)"
                          ng-class="{'variant-color-on': prod.id == vm.product.ItemCode}"
                        >
                          <span
                            class="variant-color-val"
                            data-color="{{val.Name}}"
                            ng-repeat="val in prod.filterValues track by $index"
                            ng-style=" {'background' : val.Code, 'width' : (100 / prod.filterValues.length) +'%' } "
                          >
                          </span>

                        </div>

                      </div>

                      <div ng-if=" variant.handle != 'color'  " flex="70" >
                        <md-radio-group ng-model="vm.product.ItemCode" class="md-primary">

                          <md-radio-button
                              ng-repeat="prod in variant.products"
                              ng-value="prod.id"
                              ng-click="vm.init(prod.id, true)"
                              class="" >
                             <span ng-repeat="val in prod.filterValues track by $index">
                              {{val.Name}}<span ng-if="$index < (prod.filterValues.length-1) ">, </span>
                             </span>
                          </md-radio-button>

                        </md-radio-group>
                      </div>
                    </div>
                  </div>
              </div>
            </div>

            <div class="product-view-data-block">
              <h4 >
                <strong>DISPONIBILIDAD:</strong> quedan <strong>{{vm.available | number: 0}} {{ vm.getPiecesString(vm.available) }}</strong> disponibles
              </h4>
              <div ng-if="vm.available">
                <table>
                  <tr 
                    ng-repeat="deliveryGroup in vm.deliveriesGroups"
                  >
                    <td>
                      {{deliveryGroup.date | date: "d/MMM/yyyy"}} (en {{deliveryGroup.days}} días)
                      <p>
                        <span 
                          class="comma-separated"
                          ng-repeat="d in deliveryGroup.deliveries track by $index"
                        >
                          {{ vm.getWarehouseName(d.companyFrom) }}: {{d.available}} ({{d.date | date: 'd/MMM/yyyy'}})
                        </span>
                      </p>
                    </td>
                    <td class="delivery-date-stock">
                      {{deliveryGroup.available | number: 0}} {{vm.getPiecesString(deliveryGroup.available)}}
                    </td>
                  </tr>
                </table>
              </div>
            </div>

            <div ng-if="vm.mainPromo" class="product-view-data-block product-view-data-block-v2">
              <h4 class="product-view-data-block-toggle" ng-click="vm.discountToggle = !vm.discountToggle">
                <a flex href="#" >
                  <strong>MÁXIMO DESCUENTO</strong>
                </a>
              </h4>
              <div ng-show="vm.discountToggle" class="hl-data">
                <table>
                  <tr>
                    <td>Precio Lista:</td>
                    <td class="price-col"><strong>{{vm.product.priceBefore | currency }}</strong></td>
                  </tr>
                  <tr>
                    <td>
                      <strong>{{ vm.mainPromo.discountTextPg1 ||  'Pago ÚNICO'}}
                        <span class="hl-text">(-{{vm.mainPromo.discountPg1}}%)</span>
                      </strong>
                    </td>
                    <td class="price-col">
                      <span class="crossed-text">{{vm.product.priceBefore | currency }}</span>
                       | <strong class="hl-text">{{ vm.applyDiscount(vm.mainPromo.discountPg1,vm.product.priceBefore) | currency }}</strong>
                    </td>
                  </tr>
                  <tr ng-if="vm.validPayments.paymentGroup2">
                    <td>
                      <strong>{{ vm.mainPromo.discountTextPg2 ||  '3 Meses sin intereses'}}
                        <span class="hl-text">(-{{vm.mainPromo.discountPg2}}%)</span>
                      </strong>
                    </td>
                    <td class="price-col">
                      <span class="crossed-text">{{vm.product.priceBefore | currency }}</span>
                       | <strong>{{ vm.applyDiscount(vm.mainPromo.discountPg2,vm.product.priceBefore) | currency }}</strong>
                    </td>
                  </tr>
                  <tr ng-if="vm.validPayments.paymentGroup3">
                    <td>
                      <strong>{{ vm.mainPromo.discountTextPg3 ||  '6 y 9 Meses sin intereses'}}
                        <span class="hl-text">(-{{vm.mainPromo.discountPg3}}%)</span>
                      </strong>
                    </td>
                    <td class="price-col">
                      <span class="crossed-text">{{vm.product.priceBefore | currency }}</span>
                       | <strong>{{ vm.applyDiscount(vm.mainPromo.discountPg3,vm.product.priceBefore) | currency }}</strong>
                    </td>
                  </tr>
                  <tr ng-if="vm.validPayments.paymentGroup4">
                    <td>
                      <strong>{{ vm.mainPromo.discountTextPg4 ||  '12 Meses sin intereses'}}
                        <span class="hl-text">(-{{vm.mainPromo.discountPg4}}%)</span>
                      </strong>
                    </td>
                    <td class="price-col">
                      <span class="crossed-text">{{vm.product.priceBefore | currency }}</span>
                       | <strong>{{ vm.applyDiscount(vm.mainPromo.discountPg4,vm.product.priceBefore) | currency }}</strong>
                    </td>
                  </tr>
                  <tr ng-if="vm.validPayments.paymentGroup5">
                    <td>
                      <strong>{{ vm.mainPromo.discountTextPg5 ||  '18 Meses sin intereses'}}
                        <span class="hl-text">(-{{vm.mainPromo.discountPg5}}%)</span>
                      </strong>
                    </td>
                    <td class="price-col">
                      <span class="crossed-text">{{vm.product.priceBefore | currency }}</span>
                       | <strong>{{ vm.applyDiscount(vm.mainPromo.discountPg5,vm.product.priceBefore) | currency }}</strong>
                    </td>
                  </tr>

                </table>
                <p>*Descuento aplicado con promoción: {{vm.mainPromo.publicName}}</p>
              </div>
            </div>

            <div class="product-view-prices" layout="row" layout-align="space-between end">
              <div flex="15">
                <p 
                  class="product-view-price-discount" 
                  ng-if="vm.product.Promotions && vm.product.Promotions.length > 0">
                  - {{vm.product.maxDiscount}}%
                </p>
                <p class="product-view-price-crossed">{{vm.product.priceBefore | currency:'$':0 }}</p>
                <p class="product-view-price-hl">
                  <strong>{{vm.product.Price | currency:'$':0 }}</strong>
                </p>
              </div>
              <div flex="15">
                <div class="product-view-qty input-element">
                  <label>Piezas</label>
                  <select
                    class="select-element"
                    ng-model="vm.productCart.quantity"
                    ng-options="qty for qty in vm.getQtyArray(vm.productCart.deliveryGroup.available)"
                  >
                  </select>
                </div>
              </div>
              <div flex="30">
                <div class="input-element select-element-wrapper">
                  <label>Entrega aproximada{{vm.selectedDelivery}}</label>
                  <select
                    class="select-element"
                    ng-model="vm.productCart.deliveryGroup"
                    ng-change="vm.resetCartQuantity(deliveryGrop.available)"
                    ng-options="deliveryGroup.date | date: 'd/MMM/yyyy' for deliveryGroup in vm.deliveriesGroups"
                  >
                  </select>
                </div>
              </div>
              <h3 flex="25" class="product-view-price-hl product-view-price-main">
                <strong>{{vm.product.Price * vm.productCart.quantity | currency:'$':0 }}</strong>
              </h3>
            </div>

            <a
              ng-click="vm.available && vm.productCart.quantity && vm.addToCart($event)" href="#"
              class="add-cart-btn"
              ng-class="
              {
                'add-cart-btn-disabled': vm.productCart.quantity > vm.productCart.deliveryGroup.available || !vm.productCart.quantity
              }
              "
            >
              <span class="add-cart-btn-icon">
                <span class="add-cart-btn-icon-num">{{vm.productCart.quantity}}</span>
                <i class="icon-carro"></i>
              </span>
              <strong>Agregar al carrito</strong>
            </a>
            <!--<p class="seen-number"><strong>Visto 16 veces hoy</strong></p>-->

          </div>
          <!--END PRODUCT VIEW DATA-->

        </div>

        <section class="desc-wrapper">
          <div class="desc-head" layout="row"
            ng-init="hideProductDescription = vm.toggleProductDescription = !(
              vm.product.Description ||
              vm.product.PackageContent ||
              vm.product.MainFeatures ||
              vm.product.Restrictions ||
              vm.product.Conservation
            )
            "
          >
            <div
              ng-if="!hideProductDescription"
              flex="100"
              class="desc-head-item"
              ng-class="{'desc-head-item-on' : !vm.toggleProductDescription }"
              ng-click="vm.toggleProductDescription = !vm.toggleProductDescription">
              <h3>Detalles del artículo</h3>
            </div>
            <div
              flex="100"
              class="desc-head-item"
              ng-class="{'desc-head-item-on' : vm.toggleProductDescription}"
              ng-click="!hideProductDescription && (vm.toggleProductDescription = !vm.toggleProductDescription)">
              <h3>Detalles de la entrega</h3>
            </div>
          </div>
          <div class="desc-cont">
            <article ng-if="!vm.toggleProductDescription">
              <div ng-if="vm.product.Description">
                <div ng-bind-html="vm.trustAsHtml(vm.product.Description)"></div>
              </div>

              <div ng-if="vm.product.PackageContent">
                <h3>Contenido del paquete</h3>
                <div ng-bind-html="vm.trustAsHtml(vm.product.PackageContent)"></div>
              </div>

              <div ng-if="vm.product.MainFeatures">
                <h3>Caracteristicas principles</h3>
                <div ng-bind-html="vm.trustAsHtml(vm.product.MainFeatures)"></div>
              </div>

              <div ng-if="vm.product.Restrictions">
                <h3>Restricciones</h3>
                <div ng-bind-html="vm.trustAsHtml(vm.product.Restrictions)"></div>
              </div>

              <div ng-if="vm.product.Conservation">
                <h3>Conservación</h3>
                <div ng-bind-html="vm.trustAsHtml(vm.product.Conservation)"></div>
              </div>
            </article>

            <article ng-if="vm.toggleProductDescription">
              <div ng-bind-html="vm.trustAsHtml(main.site.deliveryText)"></div>
            </article>

          </div>
        </section>

      </section>
      <!--END PRODUCT VIEW CONTENT-->
    </div>
    <!-- MAIN VIEW -->

  </div>
</div>
